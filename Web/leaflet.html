<!DOCTYPE html>
<head>
    <title>Smoke n' Maps</title>
    <meta charset="utf-8" />
    <?xml version="1.0" encoding="UTF-8"?>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
   
    <script src="https://unpkg.com/shpjs@latest/dist/shp.js"></script>

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
</head>
<body>
    <div id="mapid" style="height: 98vh; width: 99vw"></div>
    <script>
        var mymap = L.map('mapid').setView([44, -72], 8);
        
        var baseMap = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>, Data from <a href="https://geodata.vermont.gov/">Vermont GeoData Portal</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoiamNhbWJlZm9ydCIsImEiOiJja2x6Ym4xaGQwOWUxMnVyM3J2aW54bXhuIn0.vIUQw48WSxIujl74dYNqkA'
        });

        color_list = ['#4d004b', '#88419d', '#88419d', '88419d']
        // Path needs the trailing slash
        base_dir = ""
        
        function poly_style1(feature) {
            return {
                fillColor: color_list[0],
                weight: 2,
                opacity: 1,
                color: 'white',
                fillOpacity: .4
            }
        }

        function poly_style2(feature) {
            return {
                fillColor: color_list[1],
                weight: 2,
                opacity: 1,
                color: 'white',
                fillOpacity: .4
            }
        }

        function poly_style3(feature) {
            return {
                fillColor: color_list[2],
                weight: 2,
                opacity: 1,
                color: 'white',
                fillOpacity: .4
            }
        }

        function poly_style4(feature) {
            return {
                fillColor: color_list[3],
                weight: 2,
                opacity: 1,
                color: 'white',
                fillOpacity: .4
            }
        }

        function marker_style(feature) {
            return {
                fillColor: 'blue',
                weight: 2,
                opacity: 1,
                color: 'white',
                fillOpacity: .8
            }
        }

        function zones_style(feature) {
            return {
                fillColor: 'gray',
                weight: 2,
                opacity: 1,
                color: 'white',
                fillOpacity: .2
            }
        }

        let poly2_path = base_dir.concat("2.geojson");
        let poly5_path = base_dir.concat("5.geojson");
        let poly10_path = base_dir.concat("10.geojson");
        let poly20_path = base_dir.concat("20.geojson");
        let stations_path = base_dir.concat("fire_station_coords.geojson");
        let zones_path = base_dir.concat("zone_polygons.geojson");

        var poly2 = L.geoJSON(null, {style:poly_style1} ).addTo(mymap);
        var poly5 = L.geoJSON(null, {style:poly_style2} ).addTo(mymap);
        var poly10 = L.geoJSON(null, {style:poly_style3} ).addTo(mymap);
        var poly20 = L.geoJSON(null, {style:poly_style4} ).addTo(mymap);
        var stations = L.geoJSON(null, {style:marker_style} ).addTo(mymap);
        var zones = L.geoJSON(null, {style:zones_style} );

        // Use JQuery to import the geoJSON file
        $.getJSON(poly2_path, function(data) {
            poly2.setStyle(poly_style1);
            poly2.addData(data);
        });

        $.getJSON(poly5_path, function(data) {
            poly5.setStyle(poly_style2);
            poly5.addData(data);
        });

        $.getJSON(poly10_path, function(data) {
            poly10.setStyle(poly_style3);
            poly10.addData(data);
        });

        $.getJSON(poly20_path, function(data) {
            poly20.setStyle(poly_style4);
            poly20.addData(data);
        });

        $.getJSON(stations_path, function(data) {
            stations.setStyle(marker_style);
            stations.addData(data);
        });

        $.getJSON(zones_path, function(data) {
            zones.setStyle(zones_style);
            zones.addData(data);
        });
        
        stations.bindPopup(function (layer) {
            return layer.feature.properties.TOWNNAME;
        });

        baseMap.addTo(mymap);
        poly20.addTo(mymap);
        poly10.addTo(mymap);
        poly5.addTo(mymap);
        poly2.addTo(mymap);
        stations.addTo(mymap);

        poly20.bringToFront();
        poly10.bringToFront();
        poly5.bringToFront();
        poly2.bringToFront();

        var overlays = {
            "2 minutes": poly2,
            "5 minutes": poly5,
            "10 minutes": poly10,
            "20 minutes": poly20,
            "Stations": stations,
            "Emergency Service Zones": zones
        }

        L.control.layers(null, overlays).addTo(mymap);

    </script>

</body>

</html>